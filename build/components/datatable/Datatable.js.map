{"version":3,"file":"Datatable.js","sources":["../../../src/components/datatable/Datatable.tsx"],"sourcesContent":["import React, { useState, useEffect, SyntheticEvent } from \"react\"\r\nimport { defaultSearchCriteria } from \"./helpers/defaultSearchCriteria\"\r\nimport DatatableDisplay from \"./DatatableDisplay\"\r\nimport { Column, SearchCriteria } from \"./models/models\"\r\nimport { computeInitialPage } from \"./helpers/helpers\"\r\nimport {\r\n  ColumnsVisibilityMap,\r\n  getColumnNameVisible,\r\n  initColumnsVisibilityWithLocalStorage,\r\n  updateStorageConfigTable\r\n} from \"./helpers/columnVisibility\"\r\nimport { DatatableProps } from \"./DatatableProps\"\r\nimport { ReactState } from \"../types\"\r\n\r\ninterface BasicProps {\r\n  isLocalTable: boolean\r\n  hasLocalActions: boolean\r\n  hasMultipleActions: boolean\r\n  hasGlobalSearch: boolean\r\n  columnsVisibility: any\r\n  limit: number\r\n  page: number\r\n}\r\n\r\nconst Datatable = <A extends { id?: string }>(props: DatatableProps<A>): JSX.Element => {\r\n\r\n  const { name, columns, consumerKey, userId, searchCriteria, searchResult,\r\n    useLocalStorage, updateCriteria, globalSearch, multipleActions, cellActions }: DatatableProps<A> = props\r\n\r\n  const isLocalTable: boolean = !searchCriteria && !updateCriteria\r\n  const initialPage: number = computeInitialPage(searchCriteria)\r\n  const initialColumnsVisibility: ColumnsVisibilityMap = initColumnsVisibilityWithLocalStorage(name, columns, consumerKey, userId)\r\n\r\n  const [ columnsVisibility, setColumnsVisibility ]: ReactState<ColumnsVisibilityMap> = useState<ColumnsVisibilityMap>(initialColumnsVisibility)\r\n  const [ page, setPage ]: ReactState<number> = useState<number>(initialPage)\r\n  const [ selectedRows, setSelectedRows ]: ReactState<Array<A>> = useState<Array<A>>([])\r\n\r\n  const basicProps: BasicProps = {\r\n    columnsVisibility, page, isLocalTable,\r\n    hasLocalActions    : !!cellActions,\r\n    hasMultipleActions : !!multipleActions,\r\n    hasGlobalSearch    : !!globalSearch,\r\n    ...!isLocalTable && {\r\n      limit : searchResult.limit || searchCriteria.limit || 20\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (searchCriteria && updateCriteria) {\r\n        updateCriteria(defaultSearchCriteria)\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  const addRowToSelection  = (row: A): (e: SyntheticEvent) => void => {\r\n    return (event: SyntheticEvent): void => {\r\n      event.stopPropagation()\r\n      const isSelected: boolean = selectedRows.map((s: A) => s.id).indexOf(row.id) >= 0\r\n      setSelectedRows(isSelected ? selectedRows.filter((x: A) => x.id !== row.id) : selectedRows.concat(row))\r\n    }\r\n  }\r\n\r\n  const toggleAllSelect = (): void => {\r\n    const allRowsChecked: boolean = selectedRows.length === searchResult.data.length\r\n    if (!allRowsChecked) {\r\n      setSelectedRows(searchResult.data)\r\n    } else {\r\n      setSelectedRows([])\r\n    }\r\n  }\r\n\r\n  const toggleColumnVisibility = (col: Column<A>): (e: SyntheticEvent) => void => {\r\n    return (event: React.SyntheticEvent<Element, Event>): void => {\r\n      event.stopPropagation()\r\n      const valueChange: boolean = !columnsVisibility[col.field_name]\r\n      const newColumnsVisibility: ColumnsVisibilityMap = {\r\n        ...columnsVisibility,\r\n        [col.field_name] : valueChange\r\n      }\r\n      setColumnsVisibility(newColumnsVisibility)\r\n      if ( [ undefined, null, true ].includes(useLocalStorage) ) {\r\n        updateStorageConfigTable(consumerKey, userId, name, \"VISIBILITY\", getColumnNameVisible(newColumnsVisibility))\r\n      }\r\n    }\r\n  }\r\n\r\n  const onChange = (value: SearchCriteria, page?: number): void => {\r\n    updateCriteria(value)\r\n    if (page) {\r\n      setPage(page)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <DatatableDisplay<A>\r\n      {...props}\r\n      {...basicProps}\r\n      callback={onChange}\r\n      toggleColumnVisibility={toggleColumnVisibility}\r\n      selectedRows={selectedRows}\r\n      addRowToSelection={addRowToSelection}\r\n      toggleAllSelect={toggleAllSelect}\r\n    />\r\n  )\r\n}\r\n\r\nexport default Datatable\r\n"],"names":["React"],"mappings":"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"}