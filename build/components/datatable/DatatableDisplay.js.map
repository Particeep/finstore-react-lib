{"version":3,"file":"DatatableDisplay.js","sources":["../../../src/components/datatable/DatatableDisplay.tsx"],"sourcesContent":["import React, { ChangeEvent, SyntheticEvent } from \"react\"\r\nimport { Table, LinearProgress, TableContainer } from \"@material-ui/core\"\r\nimport classNames from \"classnames\"\r\nimport { buildFilterValues } from \"./filters/filters\"\r\nimport DatatableFooter from \"./DatatableFooter\"\r\nimport DatatableHead from \"./DatatableHead\"\r\nimport DatatableBody from \"./DatatableBody\"\r\nimport DatatableFilter from \"./DatatableFilter\"\r\nimport DatatableToolbar from \"./DatatableToolbar\"\r\nimport { Column, SearchCriteria } from \"./models/models\"\r\nimport { useDisplayStyles } from \"./styles/displayStyles\"\r\nimport { SearchResult } from \"../../models/SearchModel\"\r\nimport { ClassNameMap } from \"@material-ui/core/styles/withStyles\"\r\nimport { ActionMultiple, IObject } from \"../types\"\r\n\r\ninterface DatatableDisplayProps<T> {\r\n  title?: string\r\n  searchResult: SearchResult<T>\r\n  callback: (value: SearchCriteria, page?: number) => void\r\n  loading: boolean\r\n  isLocalTable: boolean\r\n  searchCriteria: SearchCriteria\r\n  columns: Array<Column<T>>\r\n  columnsVisibility: any\r\n  toggleColumnVisibility: (col: Column<T>) => (e: SyntheticEvent) => void\r\n  toggleAllSelect: () => void\r\n  addRowToSelection: (row: T) => (e: SyntheticEvent) => void\r\n  hasGlobalSearch: boolean\r\n  hasLocalActions: boolean\r\n  hasMultipleActions: boolean\r\n  multipleActions?: Array<ActionMultiple<T>>\r\n  selectedRows?: Array<T>\r\n  cellActions: (row: T) => JSX.Element\r\n  expandedRow?: (row: T) => JSX.Element\r\n  limit: number\r\n  page: number\r\n}\r\n\r\nconst DatatableDisplay = <B, >(props: DatatableDisplayProps<B>): JSX.Element => {\r\n  const classes: ClassNameMap<any> = useDisplayStyles()\r\n  const { callback, loading, isLocalTable, searchCriteria, columns, columnsVisibility, toggleColumnVisibility, toggleAllSelect,\r\n    addRowToSelection, title, hasGlobalSearch, multipleActions, selectedRows, hasLocalActions, hasMultipleActions, limit, expandedRow, searchResult, cellActions, page }: DatatableDisplayProps<B> = props\r\n\r\n  const  checkVisibilityFilter = (): boolean => {\r\n    return !columns.filter((c: Column<B>) => !!c.filter)\r\n      .map((c: Column<B>) => c.field_name)\r\n      .map((c: string) => columnsVisibility[c])\r\n      .every((c: any) => !c)\r\n  }\r\n\r\n  const onPageChange = (event: SyntheticEvent, page: number): void => {\r\n    const newSearchCriteria: SearchCriteria = { ...searchCriteria, offset: page * searchCriteria.limit } as SearchCriteria\r\n    callback(newSearchCriteria, page)\r\n  }\r\n\r\n  const onChangeRowsPerPage = (event: ChangeEvent<HTMLInputElement>): void =>  {\r\n    const newSearchCriteria: SearchCriteria = { ...searchCriteria, limit: +event.target.value }\r\n    callback(newSearchCriteria)\r\n  }\r\n\r\n  const onSearchChange = (searching: SearchCriteria): void => {\r\n    callback(searching)\r\n  }\r\n\r\n  const onSortChange = (sorting: SearchCriteria): void => {\r\n    callback(sorting)\r\n  }\r\n\r\n  const onFilterChange = (filters: IObject): void => {\r\n    callback(buildFilterValues(filters))\r\n  }\r\n\r\n  const hasFilter: boolean = checkVisibilityFilter()\r\n\r\n  const displayLocalActions: boolean = hasLocalActions && selectedRows.length === 0\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <DatatableToolbar<B>\r\n        onSearch                 = {onSearchChange}\r\n        onToggleColumnVisibility = {toggleColumnVisibility}\r\n        columns                  = {columns}\r\n        title                    = {title}\r\n        hasGlobalSearch          = {hasGlobalSearch}\r\n        columnsVisibility        = {columnsVisibility}\r\n        multipleActions          = {multipleActions}\r\n        selectedRows             = {selectedRows}\r\n        hasLocalActions          = {hasLocalActions}\r\n      />\r\n      <div className={classes.root}>\r\n        {loading && <LinearProgress className={classes.progress} />}\r\n        <TableContainer>\r\n          <Table\r\n            className={classNames({ [classes.fixedActionColumn]: hasLocalActions })}\r\n            style={{ borderCollapse: \"initial\" }} // Fix bug when apply transform on <tr>\r\n          >\r\n            <DatatableHead<B>\r\n              className           = \"TableHead\"\r\n              onSort              = {onSortChange}\r\n              onToggleAllSelect   = {toggleAllSelect}\r\n              columns             = {columns}\r\n              columnsVisibility   = {columnsVisibility}\r\n              searchCriteria      = {searchCriteria}\r\n              displayLocalActions = {displayLocalActions}\r\n              selectedRows        = {selectedRows}\r\n              limit               = {limit}\r\n              hasMultipleActions  = {hasMultipleActions}\r\n              expandedRow         = {expandedRow}\r\n              isLocalTable        = {isLocalTable}\r\n            />\r\n            {hasFilter &&\r\n            <DatatableFilter<B>\r\n              onFilter            = {onFilterChange}\r\n              columns             = {columns}\r\n              displayLocalActions = {displayLocalActions}\r\n              hasMultipleActions  = {hasMultipleActions}\r\n              columnsVisibility   = {columnsVisibility}\r\n            />\r\n            }\r\n            <DatatableBody<B>\r\n              onToggleSelect      = {addRowToSelection}\r\n              columns             = {columns}\r\n              columnsVisibility   = {columnsVisibility}\r\n              loading             = {loading}\r\n              searchResult        = {searchResult}\r\n              selectedRows        = {selectedRows}\r\n              cellActions         = {cellActions}\r\n              hasLocalActions     = {hasLocalActions}\r\n              hasMultipleActions  = {hasMultipleActions}\r\n              displayLocalActions ={displayLocalActions}\r\n              expandedRow         = {expandedRow}\r\n            />\r\n          </Table>\r\n        </TableContainer>\r\n        {!isLocalTable &&\r\n        <DatatableFooter\r\n          onPageChange        = {onPageChange}\r\n          onChangeRowsPerPage = {onChangeRowsPerPage}\r\n          searchResult        = {searchResult}\r\n          limit               = {limit}\r\n          page                = {page}\r\n        />\r\n        }\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default DatatableDisplay\r\n"],"names":["React"],"mappings":";;;;;;;;;;;;IAsCM,gBAAgB,GAAG,UAAM,KAA+B;;IAC5D,IAAM,OAAO,GAAsB,gBAAgB,EAAE,CAAA;IAC7C,IAAA,QAAQ,GACmL,KAAK,SADxL,EAAE,OAAO,GAC0K,KAAK,QAD/K,EAAE,YAAY,GAC4J,KAAK,aADjK,EAAE,cAAc,GAC4I,KAAK,eADjJ,EAAE,OAAO,GACmI,KAAK,QADxI,EAAE,iBAAiB,GACgH,KAAK,kBADrH,EAAE,sBAAsB,GACwF,KAAK,uBAD7F,EAAE,eAAe,GACuE,KAAK,gBAD5E,EAC1H,iBAAiB,GAAgL,KAAK,kBAArL,EAAE,KAAK,GAAyK,KAAK,MAA9K,EAAE,eAAe,GAAwJ,KAAK,gBAA7J,EAAE,eAAe,GAAuI,KAAK,gBAA5I,EAAE,YAAY,GAAyH,KAAK,aAA9H,EAAE,eAAe,GAAwG,KAAK,gBAA7G,EAAE,kBAAkB,GAAoF,KAAK,mBAAzF,EAAE,KAAK,GAA6E,KAAK,MAAlF,EAAE,WAAW,GAAgE,KAAK,YAArE,EAAE,YAAY,GAAkD,KAAK,aAAvD,EAAE,WAAW,GAAqC,KAAK,YAA1C,EAAE,IAAI,GAA+B,KAAK,KAApC,CAAoC;IAExM,IAAO,qBAAqB,GAAG;QAC7B,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,UAAC,CAAY,IAAK,OAAA,CAAC,CAAC,CAAC,CAAC,MAAM,GAAA,CAAC;aACjD,GAAG,CAAC,UAAC,CAAY,IAAK,OAAA,CAAC,CAAC,UAAU,GAAA,CAAC;aACnC,GAAG,CAAC,UAAC,CAAS,IAAK,OAAA,iBAAiB,CAAC,CAAC,CAAC,GAAA,CAAC;aACxC,KAAK,CAAC,UAAC,CAAM,IAAK,OAAA,CAAC,CAAC,GAAA,CAAC,CAAA;KACzB,CAAA;IAED,IAAM,YAAY,GAAG,UAAC,KAAqB,EAAE,IAAY;QACvD,IAAM,iBAAiB,GAAmB,sBAAK,cAAc,KAAE,MAAM,EAAE,IAAI,GAAG,cAAc,CAAC,KAAK,GAAoB,CAAA;QACtH,QAAQ,CAAC,iBAAiB,EAAE,IAAI,CAAC,CAAA;KAClC,CAAA;IAED,IAAM,mBAAmB,GAAG,UAAC,KAAoC;QAC/D,IAAM,iBAAiB,yBAAwB,cAAc,KAAE,KAAK,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,GAAE,CAAA;QAC3F,QAAQ,CAAC,iBAAiB,CAAC,CAAA;KAC5B,CAAA;IAED,IAAM,cAAc,GAAG,UAAC,SAAyB;QAC/C,QAAQ,CAAC,SAAS,CAAC,CAAA;KACpB,CAAA;IAED,IAAM,YAAY,GAAG,UAAC,OAAuB;QAC3C,QAAQ,CAAC,OAAO,CAAC,CAAA;KAClB,CAAA;IAED,IAAM,cAAc,GAAG,UAAC,OAAgB;QACtC,QAAQ,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAA;KACrC,CAAA;IAED,IAAM,SAAS,GAAY,qBAAqB,EAAE,CAAA;IAElD,IAAM,mBAAmB,GAAY,eAAe,IAAI,YAAY,CAAC,MAAM,KAAK,CAAC,CAAA;IAEjF,QACEA,sCAAK,SAAS,EAAE,OAAO,CAAC,IAAI;QAC1BA,6BAAC,gBAAgB,IACf,QAAQ,EAAoB,cAAc,EAC1C,wBAAwB,EAAI,sBAAsB,EAClD,OAAO,EAAqB,OAAO,EACnC,KAAK,EAAuB,KAAK,EACjC,eAAe,EAAa,eAAe,EAC3C,iBAAiB,EAAW,iBAAiB,EAC7C,eAAe,EAAa,eAAe,EAC3C,YAAY,EAAgB,YAAY,EACxC,eAAe,EAAa,eAAe,GAC3C;QACFA,sCAAK,SAAS,EAAE,OAAO,CAAC,IAAI;YACzB,OAAO,IAAIA,6BAAC,cAAc,IAAC,SAAS,EAAE,OAAO,CAAC,QAAQ,GAAI;YAC3DA,6BAAC,cAAc;gBACbA,6BAAC,KAAK,IACJ,SAAS,EAAE,UAAU,WAAG,GAAC,OAAO,CAAC,iBAAiB,IAAG,eAAe,MAAG,EACvE,KAAK,EAAE,EAAE,cAAc,EAAE,SAAS,EAAE;oBAEpCA,6BAAC,aAAa,IACZ,SAAS,EAAa,WAAW,EACjC,MAAM,EAAiB,YAAY,EACnC,iBAAiB,EAAM,eAAe,EACtC,OAAO,EAAgB,OAAO,EAC9B,iBAAiB,EAAM,iBAAiB,EACxC,cAAc,EAAS,cAAc,EACrC,mBAAmB,EAAI,mBAAmB,EAC1C,YAAY,EAAW,YAAY,EACnC,KAAK,EAAkB,KAAK,EAC5B,kBAAkB,EAAK,kBAAkB,EACzC,WAAW,EAAY,WAAW,EAClC,YAAY,EAAW,YAAY,GACnC;oBACD,SAAS;wBACVA,6BAAC,eAAe,IACd,QAAQ,EAAe,cAAc,EACrC,OAAO,EAAgB,OAAO,EAC9B,mBAAmB,EAAI,mBAAmB,EAC1C,kBAAkB,EAAK,kBAAkB,EACzC,iBAAiB,EAAM,iBAAiB,GACxC;oBAEFA,6BAAC,aAAa,IACZ,cAAc,EAAS,iBAAiB,EACxC,OAAO,EAAgB,OAAO,EAC9B,iBAAiB,EAAM,iBAAiB,EACxC,OAAO,EAAgB,OAAO,EAC9B,YAAY,EAAW,YAAY,EACnC,YAAY,EAAW,YAAY,EACnC,WAAW,EAAY,WAAW,EAClC,eAAe,EAAQ,eAAe,EACtC,kBAAkB,EAAK,kBAAkB,EACzC,mBAAmB,EAAG,mBAAmB,EACzC,WAAW,EAAY,WAAW,GAClC,CACI,CACO;YAChB,CAAC,YAAY;gBACdA,6BAAC,eAAe,IACd,YAAY,EAAW,YAAY,EACnC,mBAAmB,EAAI,mBAAmB,EAC1C,YAAY,EAAW,YAAY,EACnC,KAAK,EAAkB,KAAK,EAC5B,IAAI,EAAmB,IAAI,GAC3B,CAEE,CACF,EACP;AACH;;;;"}